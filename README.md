# CosyVoice 交互式语音合成工具

> 基于 [FunAudioLLM/CosyVoice](https://github.com/FunAudioLLM/CosyVoice) 项目的交互式语音合成工具。CosyVoice 是一个强大的多语言、低延迟的语音合成模型，支持零样本语音克隆和多种语言混合。

## 原始项目信息

- **项目地址**: [https://github.com/FunAudioLLM/CosyVoice](https://github.com/FunAudioLLM/CosyVoice)
- **官方演示**: [https://funaudiollm.github.io/cosyvoice2/](https://funaudiollm.github.io/cosyvoice2/)
- **论文**: [CosyVoice 2.0 Paper](https://arxiv.org/abs/2412.10117)

## 功能概述

`test.py` 是一个基于 CosyVoice 模型的交互式语音合成工具，允许用户通过命令行界面生成高质量的语音。该工具支持以下主要功能：

1. **零样本语音克隆**：使用提供的音频样本作为参考，合成具有相似音色的语音
2. **长文本处理**：自动将长文本分割成适当的段落，逐段合成后合并
3. **内存优化**：实现了内存管理机制，防止长时间运行时的内存泄漏
4. **错误处理**：提供了健壮的错误处理机制，确保在遇到问题时能够继续运行
5. **音频长度检测**：自动检测提示音频的长度，防止使用超过30秒的音频导致合成失败

## 使用方法

1. 确保已安装所有依赖项并下载了模型
2. 运行脚本：`python test.py`
3. 按照提示选择参考音频文件
4. 输入要合成的文本
5. 合成的音频将保存在指定目录

## 技术特点

- **文本预处理**：使用正则表达式和自定义逻辑处理文本，确保最佳合成效果
- **音频长度检查**：自动检测并警告超过30秒的音频文件，防止模型错误
- **内存管理**：定期清理内存和CUDA缓存，优化长时间运行性能
- **错误恢复**：实现了多层错误处理机制，在合成失败时提供备选方案

## 注意事项

- 提示音频不应超过30秒，否则可能导致合成失败
- 对于非常长的文本，建议分多次输入处理
- 合成质量受参考音频质量的影响

## 更新日志

### 最新更新

- 添加了音频长度检测功能，防止使用过长的音频导致合成失败
- 优化了内存管理，减少长时间运行时的内存泄漏
- 改进了文本分割算法，更好地处理长文本输入
- 增强了错误处理机制，提高了系统稳定性
